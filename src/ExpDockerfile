# Base image with Python and Conda
FROM continuumio/miniconda3:latest

# Set the working directory inside the container
WORKDIR /exp_agent

# Copy the current directory into the container
COPY ./src /exp_agent
COPY ./benchmark /benchmark
COPY ./starter_file /starter_file
COPY ./eval_metadata /eval_metadata

# Install dependencies from the Conda environment file
RUN conda env create -f environment.yml && \
    conda clean -a

RUN /opt/conda/bin/conda init bash

# Update the package list and install vim
RUN apt-get update && apt-get install -y vim

# Install cloud related dependencies:
RUN chmod +x setup/install_aws_cli.sh
RUN setup/install_aws_cli.sh

RUN mkdir -p /workspace
RUN mkdir -p /temp/logs/

# Set PATH to activate the Conda environment automatically in the container
ENV PATH=/opt/conda/envs/langgraph/bin:$PATH

# Ensure bash is the default shell
SHELL ["/bin/bash", "-c"]

# Default command
# CMD ["bash"]
# Keep container running
CMD ["tail", "-f", "/dev/null"]